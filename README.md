# ComputerNetwork
* 因特网（互联网）
    * 计算机网络的代表
    * 全球第二大网络，仅次于全球电话网
    * 起源于美国，是“网络的网络”
    * 网络是由若干`结点`和连接这些结点的`链路`组成
    * 连接在因特网上的计算机都称为`主机`
* 计算机网络：
    地理位置不同，具有独立功能的`多个计算机系统`通过`通信设备`和`线路`，用`网络软件`使网络资源`共享`的系统
* Internet
    * 大量不同网络构成的网络
    * 使用同一组`公共协议`
    * 提供一组`公共服务`
* www
    * 分布式应用系统，运行在Internet之上
*网络将主机连接在一起，互联网将网络连接在一起，故称为`网络的网络`*
* 计算机网络形成的技术基础
>数据通信技术的日趋成熟
* 计算机网络研究的理论基础
>分组交换概念的提出
* 证明分组交换理论的正确性
>AROANET的成功运行
* 更大规模的网络互联的基础
>TCP/IP协议的广泛应用
* 因特网的组成
>边缘部分：主机（端系统）
>核心部分：网络、路由器
* 主机之间的通信实际上是指主机上某个`进程`与另一台主机上的某个`进程`的通信
* 两种通信方式
>1.客户端-服务器（c/s）
>2.对等方式（p2p）
  本质上仍是C/S，知识每一个主机既是客户又同时是服务器
* 因特网的核心部分
>交换方式
>因特网中最复杂的部分：网络核心
>网络核心中起特殊作用的:路由器
>路由器是实现**分组交换**的关键构建，
 任务：转发收到的分组->网络核心最重要的功能

 * 电路交换
>以电话机为例
>两两相连
>握手原则：N（N-1）/2
>当电话机数量过多，要使用**交换机**

三个阶段：
>1.建立连接
>2.通信
>3.释放连接

存在问题:
>计算机数据具有突发性，导致通信线路利用率很低

* 分组交换
>将较长的报文划分为**较短的**、**固定长度**的数据段
>每一个数据段前添加**首部**构成分组->数据传输的单元

分组的重要性：
>每一个分组的首部都含有**地址**等控制信息
>分组交换网中的结点交换机根据收到分组首部的**地址信息**，把分组转发到下一个结点交换机
>通过这种*存储转发*方式，最后分组就能到达**最终目的地**
*接收端收到分组，去除首部，进行还原*

网络核心部分的**路由器**一般用**高速链路**相连接，网络边缘的**主机**以**相对速率较低的链路**相连接

主机：为用户进行信息处理，与其他主机通过网络交换信息
路由器：转发分组，即进行分组交换的

* 路由器处理分组的过程：
>1.把收到的分组放入**缓存**
>2.查找转发表，找出到某个目的地址应从哪个**端口**转发
>3.把分组送到适当的**端口**转发出去

* 分组交换的优点
>1.高效：动态分配带宽，对通信链路是逐段占用
>2.灵活
>3.迅速：不必先建立连接就能向其他主机发送分组
>4.可靠：网络协议可靠；分布式路由选择协议使网络的生存性好

* 分组交换的问题
>1.各结点转发造成的时延
>2.首部的开销

* 三种交换的对比
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/2.JPG)

* 几种不同类别的网络
    * 根据作用范围来分类
        >1.广域网WAN <1000km
        >2.城域网MAN <100km
        >3.局域网LAN <10km
        >4.个人区域网PAN <10m


### 计算机的性能指标
>1.速率
>2.带宽
>3.吞吐量
>4.时延

* 速率（数据率或者比特率）
>单位：bit 一个二进制数字 1或者0
b/s、kb/s、Mb/s、Gb/s
>含义：主机在通信信道上传送数据的速率
* 带宽
>信号具有的频带宽度
>单位：赫、千赫、兆赫、吉赫
>现在的带宽是通信信道所能传送的“最高数据率”的同义词，单位“比特每秒”，b/s，bit/s

类比：核定功率和实际功率，核定功率是实际功率的最大值。带宽是核定速率

![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/3.JPG)
**在时间轴上信号的宽度随带宽的增大而变窄**
即带宽越大，传输时间越短
* 吞吐量
>单位时间内通过某个网络（或信道、接口）的数据量
>更经常用于对现实世界的网络测量
>受带宽或网络的额定速率的限定

*在同一条线路上对于相同的对象，必存在 速率>吞吐量？*

* 时延
以结点A发送到结点B为例
>结点A中产生**处理时延**和**排队时延**
>结点A的发送端产生**发送时延**
>A到B的链路上产生**传播时延**

发送时延：
>发送数据，数据帧从结点进入传输媒体所需要的时间
>从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕
>公式：发送时延=数据帧长度（b）/发送速率（b/s）

传播时延：
>电磁波在信道中需要传播一定的距离而花费的时间
>公式：传播时延=信道长度（米）/信号在信道上的传播速率（米/秒）

*班级出游，一个班43个同学，从第一个同学开始上校车，到第43个同学上校车所产生的时间，即为**发送时延**。校车从学校到目的地所需要的时间为**传输时延**。*

**信号发送速率和信号在信道上的传播速率完全不同**
即上校车的**速度**和校车的**行驶速度**完全无关

处理时延：
>交换结点为存储转发而进行一些必要的处理所发费的时间

*上校车之前老师交代本次活动的注意事项*

排队时延：
>结点缓存队列中分组排队所经历的时延
>取决于网络当时的通信量

*按照规则，按照班级，要上一个班级登上其所在的校车，当前班级才可以排队进入等候区，前面未上车的班级越多，**排队时延**越长*

总时延是各时延之和
即
>总时延=发送时延+传播时延+处理时延+排队时延

**<del>带宽越高，比特传输越快</del>**
信道传输速率与传播速率
>高速网路链路仅仅提高了**发送速率**，即减少了**发送时延**，而非**比特在链路上的传输速率**

*即校车可以更快的到达高速公路，但不会在高速公路上跑的更快*

光纤信道的传输速率高是指**发送数据**的速率很高，**信道上的传播速率**甚至略低于铜线

* 时延带宽积
>以比特为单位的链路长度
>链路上的最大比特数（信道被充分利用）

*将比特充满信道的截面，类似于比特流*
*充满高速公路，且保持核定速率前行的车流*

* 往返时间RTT
>从请求方发送消息开始到接受到回复，共经历的时间

>卫星的往返时延较长，故将RTT作为重要的性能指标

*信道利用率
>信道有百分几的时间是被利用的（有数据通过）
网络利用率
>全网络的信道利用率的加权平均值

*信道利用率并非越高越好*
信道作为共享资源，越利用率过高，信道可能处于繁忙状态，用户无法接入
利用率过低，通信公司的经济上不合算

即信道利用率增加，该信道的时延也迅速增加
公式：D=A（1-U）
其中U为信道利用率（0-1），A为空闲状态下的时延，D为当前状态下的时延

### 计算机网络的非性能特征
>费用
>质量
>标准化
>可靠性
>可扩展性和可升级性
>易于管理和维护

### 计算机网络的四个重要的概念
>协议
>层次
>接口
>体系结构
* 网络协议
含义：
>为进行网络中的数据交换而建立的规则、标准或约定
三要素：
> 1.语法：数据与控制信息的结构或格式
> 2.语义：需要发出何种控制信息，完成何种动作，作出何种响应
> 3.同步：事件顺序的详细说明
* 层次
> 为处理复杂问题而进行分层
> 高层可以使用低层的服务，而不需要知道其实现细节。
> 不同系统的最底层存在着“物理”通信
对等层之间存在着“虚拟”通信

分层的好处
>1.各层间独立
>2.灵活性好
>3.结构上可分割开
>4.易于实现和维护
>5.能促进标准化工作

* 接口
含义
>同一结点内**相邻层**之间交换信息的连接点
>低层通过接口向高层提供服务
>只要接口条件和低层功能不变，低层的具体实现方法不影响整个系统的工作

*类比ssh框架里的dao->servlet->action*

*分层是不同主机间对应进程，接口是一个主机内的不同层次*
* 网络体系结构
>按**层次结构**进行组织的
>层次结构模型与各层协议的集合

*即如何分层和每一层的规则*
>对计算机网络应该实现的功能进行了**精确**的定义
>抽象的
* OSI模型（理论上的，未实现）
三级抽象
>1.体系结构
>2.服务定义
>3.协议说明

![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/4.JPG)
各层的功能：
物理层：
>利用传输介质为通信的**网络结点**之间建立、管理和释放物理连接
>实现比特流的透明传输，为数据链路层提供数据传输服务
>数据传输单元：**比特**

数据链路层：
>在通信的**实体**之间建立数据链路连接
>传输**以帧为单位的数据包**
>采用差错控制和流量控制，使有差错的物理线路变成无差错的数据链路

网络层：
>通过路由选择算法**选择最适当的路径**
>数据传输单元：**分组**
>实现拥塞控制、网络互连等功能

传输层：
>向用户提供可靠**端到端**服务
>处理数据包错误、数据包次序、以及其他一些关键传输问题
>对高层屏蔽了下层数据通信的实现细节，是计算机通信体系的**关键**一层
>数据传输单元：**报文**

会话层：
>维护两个结点之间的传输链接，确保点到点的传输不中断
>管理数据交换

表示层：
>处理两个通信系统中交换信息的表示方式
>数据格式变换
>数据加密与解密
>数据压缩与恢复

应用层：
>为应用程序提供网络服务
>需要识别并保证通信对方的可用性，使得协同工作的应用程序之间的同步
>建立传输错误纠正与保证数据完整性的控制机制

* TCP/IP
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/5.JPG)
116-120

综合ISO和TCP/IP，使用五层协议的体系
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/6.JPG)

主机1向主机2发送数据
主机1向下传输，加入首部
主机2向上传输，剥去首部
*数据链路层同时要加上尾部*
*即穿衣服和脱衣服的过程*

* 实体
>任何可发送或接收信息的硬件和软件
* 协议
>对等实体间通信的规则的集合，即某一层的协议

*协议使**水平的**，服务是**垂直的***

同一系统相邻两层的实体进行交互的地方：
服务访问点SAP
接口？

协议要考虑能否应付各种异常情况

路由器转发分组时最多只到**网络层**

### 物理层详解
* 主要任务
>确定与传输媒体的接口的一些特性
>1.机械特性：接线器的形状和尺寸、引线数目和排列、固定和锁定装置
>2.电气特性：接口电缆上各条线的**电压**范围
>3.功能特性:电平、电压的意义
>4.过程特性：不同功能的各种可能事件的出现顺序

*与硬件的接口*
* 主要考虑的问题
>如何在连接开放系统的传输介质上传输各种数据的比特流

*即数据在传输介质上的传输问题*
但传输介质不是物理层，处于物理层下层，物理层来控制在介质上传输什么，怎样传输（电气特性），而传输介质不具备此种控制功能。

* 数据
>运送消息的实体

 信号
>数据的电气或电磁表现

* 模拟信号与数字信号
>连续与离散
>to be continue...

* 单向通信（单工通信）
>只有一个方向的通信，无交互
老师在蓝墨云上发送通知
 
 双向交替通信（半双工通信）
>双方都可以发送信息，但是不能同时发送
不太恰当，传球，A可以传给B，B可以传给A，但在某个时间，只有一个人是发送方，一个人是接收方

 双向同时通信（全双工通信）
>双方可以同时发送，同时接受信息
和喜欢的妹子聊天（也可能是单工通信）

* 并行通信
>多条跑道（传输设备），同时发送比特
适用场景：
近距离，要求速度的场景

串行通信
>数据流一位位传送，只需要一根传输线，易于实现
排排队，一个一个来

* 基带信号
>基本频带信号-来自信源的信号
>**计算机输出**的代表各种文字或者图片文件的**数据信号**都属于基带信号

基带调制
>基带信号的低频成分过多，甚至有直流成分，很多信道无法传输，故要进行调制-编码
* 数字数据的编码方式
*除了模拟信号传输模拟数据，其他三种类型的传输均需要经过编码*
*数-数，数-模，模-数*
>例子：信号 0 1 0 1 1 0

非归零码NRZ：
>编码不变+一个同步信号（保证手法双方的同步）
>编码：0 1 0 1 1 0
同步信号：10 10 10 10 10 10

若“1”和“0”的个数不相等，存在直流分量？
此处是指同步信号中，还是编码中？

曼彻斯特编码：
>将T均分,前T/2为反码，后T/2为原码
自含钟编码
编码：10 01 10 01 01 10

差分曼彻斯特编码：
>1.每比特中间的跳变仅做同步之用
2.利用边界是否发生跳变来决定比特的值
跳变->0,不跳变->1
编码：10 01 01 10 01 01

* 带通信号
>基带信号经过**载波调制**后的信号

二元制调制方法：
>1.调幅（AM）：载波的**振幅**随数字信号变化
2.调频（FM）：载波的**频率**随数字信号变化
3.调相（PM）：载波的**初始相位**随数字信号变化

公式：
>u(t)=u*sin(wt+q)

三个可以改变的电参量
>1.振幅：u
2.角频率：w
3.相位：q

正交振幅调制？？？

波特率(调制速率)：
>位时间内载波参数变化的次数
>描述码元传输的速率
单位：波特每秒

**比特率=波特率*单个调制状态对应的二进制位数**

两相调制：比特率=波特率
四相调制：比特率=2X波特率
八相调制：比特率=3X波特率

* 信道的极限容量
*传输信号时不可避免的产生失真以及多种干扰*
>**码元传输的速率**越高、信号**传输距离**越远，在信道的输出端的波形失真就越严重。

产生结果：
1.有失真，但可以识别
2.失真过大，无法识别

* 限制码元在信道上传输速率的因素
1.信道能够通过的频率范围
>奈奎斯特准则:
为避免码间干扰，码元传输速率的上限值：
R<sub>max</sub>=2*B  （b/s）
B为通信信道带宽（Hz）

*即带宽越高，就可以用更高的速率传送码元而不产生码间干扰*

2.信噪比
>存在于几乎所有的电子设备和通信信道中，随机产生
>影响是相对的，信号强，则噪声的影响就相对较小

信噪比=信号平均功率和噪声的平均功率之比
>信噪比（dB）= 10log<sub>10</sub>(S/N)
当S/N=1000，信噪比为30dB

信道的极限信息传输速率C
>香农定理
带宽受限，且受高斯白噪声干扰
C=Wlog<sub>2</sub>(1+S/N) (b/s)
W:信道的带宽（Hz）
S:信道内所传信号的平均功率
N:信道内部的高斯噪声功率

**带宽**或**信噪比**越大，信息的**极限传输速率**就越大

若带宽已确定，信噪比也已经无法提高，是否还能提高信息的传输速率？
>用编码的方法让**一个码云携带更多比特**的信息量

**怎么理解码元**
假设基带信号为
>101011101

直接传送，每个码元携带的信息就是1bit

若是三个一组传送
>101 011 101

即三个码元，每个码元为3bit
若接受方要唯一确定这个码元，则需要8中不同的振幅或者频率或者相位

*此时 比特率=波特率X3*

* 信道复用
>频分复用
时分复用
统计时分复用

信号共用一条信道->复用
信道分解出信号->分用

* 频分复用FDM
用户自始至终占用某个频带：频率带宽
->路由器发射的频率宽度（Hz）
并非数据的发送速率

*同时不同频*
*即不同的用户相同时间占用不同的带宽资源*

* 时分复用TDM
>将时间划分为一段段等长的时分复用帧（TDM帧），每一个用户所占用帧周期性出现
所有用户不同时间占用同样的频带宽度
TDM信号又称等时信号

*同频不同时*
*类比时间片算法*

问题：
>计算机数据的突发性，子信道利用率不高

*即存在四个任务A B C D，把每一小段时间分为四段时间帧分别分配给4个任务，若B任务仅在开始和结束进行，中间分配给他的时间段，其他任务无法使用，就造成了浪费。*

改进：
>统计时分复用STDM

针对上述情况将任务进行了穿插

*利用率高，实现难度大*

* 波分复用WDM
>光的频分复用

* 码分复用CDM
>码分多址CMDA
各用户使用不同的码型，彼此不造成干扰
抗干扰性好，类似白噪声，不易被敌人发现

实现
>每一个比特时间划分m个短的时间间隔，称为码片，每个站被指派唯一的m bit码片
>发送比特1，发送自己的m bit码片序列
>发送比特2，发送上述的反码

若要发送的信号为
>10110

qxy同学的码片序列是
>qxy

此处假设反码为yxq

则其编码为
>qxy yxq qxy qxy yxq

lzy同学的码片序列为
>lzy

若bxy想要接收qxy同学的消息
其接收
>qxy yxq qxy qxy yxq

不接收
>lzy yzl lzy lzy yzl

*这里相当于扩充了1 0的信息，让其既能表示1 0，又可以展示身份信息，便于接收方认领*
这种方式叫作：
>扩频
>1.直接序列扩频DSSS（上述即是这一类）
>2.跳频扩频FHSS

*必须保证不同同学扩充编码方式不同，不然接受方无法准去识别*
即各站的码片序列不仅**必须各不相同**，
还必须**相互正交**

内积为0，向量S*向量T=0
向量S*向量S=1
向量S*其反码的向量=-1（用来解码）

实用系统中使用的是
>伪随机码序列


* ADSL
>对现有的模拟电话用户线进行改造，使它能够承载宽带业务

原理：
>将0~4kHz**地段频谱**留给传统电话，将原来没被利用的**高端频谱**留给用户上网使用

极限传输距离
>与**数据率**及**用户线的线径**有关
>与传输速率反比
与线径正比

最高数据传输速率
>与**信噪比**有关

### 数据链路层详解
* 两种信道类型
>1.点对点信道：一对一
2.广播信道：一对多

* 点对点信道
链路：
>无源的点到点的物理线路段，中间没有任何其他交换结点，一条通道的组成部分

数据链路：
>物理线路+通信协议
>常用方法：适配器（网卡）->一般包含数据链路层和物理层两层的功能

传输单位：
>帧

为什么设计数据链路层？
>物理层传输数据信号有差错

方法：
>1.差错检测
2.差错控制
3.流量控制

作用：(改掉差错呗)
>改善数据质量，*向网络层提供高质量的服务，为网络层屏蔽物理层采用的传输技术的差异性*（每一层的作用都是：向上层服务，对上层屏蔽下层实现）

差错的产生：
>因为存在噪声
>随机差错（热噪声引起）+突发差错（冲击噪声引起）

引起突发差错的位长称为**突发长度**

数据链路层解决的基本问题：
>1.封装成帧
2.透明传输
3.差错控制

* 封装成帧
*按帧传输首先要确定何为一个帧，如何界定一个帧？加首部，加尾部*
>帧=帧首部+ip数据报+帧尾部
>帧=SOH+ip地址+EOT

检测到SOH，即为帧的开始，检测到EOT，即为帧的结束
* 透明传输
*即无论传什么bit，都要能传*

若传输下面的一个帧
>**SOH**QNUJ**EOT**HJJKDSJ**EOT**

ip数据报中出现了终止符，则之后的数据被接收端当做无效帧而舍弃，发生错误

解决办法：
>当数据报中出现`SOH`、`EOT`、转义字符时，在其前面添加转义字符`ESC`。
送往网络层时，删除转义字符。（字节填充）
连续收到两个转义字符，仅删除前面的一个

* 比特差错
*即传输过程中，0可能变成1，1可能变成0*

误码率：
>错误比特/总比特

和**信噪比**有关

所以为办证数据传输的可靠性，要引入**差错检测**

* 差错检测
1.奇偶校验码
>在最高位或最低位添加一位校验码，比对校验码来检测是否发生错误

奇校验：
>使得连同校验码在内的1的位数为奇数

偶校验：
>使得连同校验码在内的1的位数为偶数

原数|奇校验|偶校验
----|-----|----
1001|1001 1|1001 0
1101|1101 0|1101 1

校验过程：
发送一串数据
>11100

使用奇校验，校验码为0
>111000

接收方收到
>111000

使用奇校验，添加校验码为
>0

故传输过程中未产生差错

*仅仅能判断是否出错，不能发现错误在哪*

2.循环冗余编码CRC
>核心：实际上是同时对同一个多项式所转换的二进制求余，比较余数是否相同。
只是发送方对数据做了调整，加上了余数，故接收方应求余为0才正确。

*使用例子来解释具体计算过程*
举例：
待校验数据：
>10101011

生成多项式为
>10011
即x<sup>4</sup>+x+1

如何完成校验过程？
发送端：
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/循环编码发送.jpg)
接收端：
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/循环编码接收.jpg)

**检错能力强，能检测出出错位置**

* 海明码
to be continue...


##### PPP点对点协议

全世界使用最多的数据链路层协议
用户使用拨号电话线接入因特网时，一般使用的都是PPP协议

* 三部分组成
>1.一个将IP数据报封装到串行链路的方法
2.链路控制协议
3.网络控制协议

ppp是面向字节的，所有PPP帧的长度都是整数字节

* 帧格式
>首部（F A C 协议）+信息字段+尾部（FCS F）
其中F:标志字段 =x7E
A:地址字段，只为0xFF，不起作用
C：控制字段，通常为0x03
协议字段：
1.当为0x0021时，信息字段为**IP数据报**
2.当为0xC021时，信息字段为**PPP链路控制数据**
3.当我0x8021时，信息字段是**网络控制数据**

异步传输时使用特殊的字符填充
>1.出现0x7E，转变为0x7D，0x5E
2.仅出现一个0x7D，转变为0x7D，0x5D
3.若出现ASCII码控制字符，在该字符前加入0x7D，同时改变该字符编码

同步传输时，采用硬件进行比特填充
>发送端：发现五个连续的1，填入一个0
>接收端：发现五个连续1，将跟在后面的0删除

避免出现了类似标志字段的：
>0111111000

* 广播信道
局域网：
>网络为一个单位所拥有，且地理范围和站点数目有限

优点：
>具有广播功能，从一个站点可以访问全网，共享资源
>易于扩展
>提高了可靠性、可用性和残存性

* 媒体共享技术
    * 静态划分信道
        1.频分复用
        2.时分复用
        3.波分复用
        4.码分复用
    * 动态媒体接入控制（多点接入）
        1.随机接入
        2.受控接入（多点线路探询，轮询）
    
* 数据链路层的两个子层
>1.逻辑链路控制子层LLC
2.媒体接入控制子层MAC

MAC：负责所有与接入到媒体有关的内容
LLC：与接入媒体无关，局域网采用的协议对LLC子层透明

*即 物理层->MAC->LLC->网络层*

LLC以后逐渐被弃用，不考虑

* 适配器
网路接口板，又称通信适配器、网络接口卡、网卡

重要功能：
>1.进行串行/并行转换
2.对数据进行缓存
3.在计算机的操作系统安装设备驱动设备
4.实现以太网协议

计算机通过适配器和局域网进行通信
CPU和处理器（ip地址）-> 适配器（硬件地址）-> 局域网串行通信

在具有广播特性的主线上实现一对一通信：
>最初的以太网将计算机连接到一条总线上
B发送信息给A
D、E都可以检测，但是首部地址不一致，只能丢弃，只有A可以接受

以太网为了通信简便，采取以下两种措施
>1.无连接的控制方式：不必事先建立连接即可直接发送数据
2.对发送的数据帧不进行编号，也不要求对方发回确认
因为局域网信道质量很好，因信道质量产生差错的概率很小

以太网提供的服务
>1.尽力而为：不可靠的交付，尽最大努力的交付    TCP?
2.目的站收到有差错的数据帧只执行**丢弃**处理，纠错交给高层决定
3.高层进行重传时，以太网并不知道，仅当作一个新的数据帧来发送

以太网发送的数据使用**曼彻斯特**编码

* 载波监听多点接入/碰撞检测
>广泛的用于局域网的MAC层
是以太网采用的协议

>为解决如何争用一个广播型的共享传输信道二设计，它决定该谁占用信道

载波监听：
>检测是否已经有结点利用总线在发送数据

*利用电平跳变*

碰撞检测：
>计算机边发送数据边检测信道上的信号电压的大小
当几个站同时在总线上发送数据，总线的电压摇摆值会增大
当一个站检测到信号电压摆动值超过一定的门限值，即发生了碰撞
又称“冲突检测”

发生碰撞后：
>信号严重失真
每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，等待一段随机事件后再次发送

某个站监听到总线空闲时，并非一定真正空闲
A发送数据给B，在传输到B之前，若B发送数据给A，则必发生碰撞，两个帧都无用
假设A发送给B的时间为**T**，则只要经过**2T**未检测到碰撞，则可以肯定这次发送不回发生碰撞
其中**2T**被称为**争用期**，或**碰撞窗口**

为什么会发生这种情况？
>使用CSMA/CD的以太网是半双工通信的（双向交替通信）

这种发送的不确定性使得以太网的**平均通信量**远小于一台网的**最高数据通信量**

随机时间后可以再次发送，如何确定此随机时间？
>随机时间=r<sub>0</sub>*T
其中r<sub>0</sub>=2<sup>k</sup>-1
其中k的值：当k<=10,k的值为重传次数，大于10，k的值为10
当重传次数大于16次，丢弃该帧，并向高层报告

CSDA/CD发送流程
>先听后发、边听边发、冲突停止、延迟从发

*站点监听主线是否空闲，若空闲，立即发送，一边发送数据一边检测冲突信号，若检测到冲突信号即停止数据发送，等待随机时间，重新尝试发送*

以太网的争用期长度`51.2us`
10Mb/s的以太网，在争用期可以发送512bit的数据，即64字节
即以太网发送数据，前64字节不发生冲突，后续的数据就不会发生冲突。

换句话说，冲突一定发生在前64字节之内。
一检测到冲突就立刻停止，故发送出去的数据一定小于64字节
以太网规定**最短有效帧**为64字节，凡是小于6
4字节的帧都是由于冲突而异常中止的无效帧

强化碰撞：
>一旦发生碰撞：
1.立即停止发送数据
2.再继续发送若干比特的人为**干扰信号**，以便让所有用户都知道现在已经发生了碰撞

以太网的演变：
粗同轴电缆->细同轴电缆->双绞线（星形拓扑）
在星形的中心增加了一种可靠性非常高的设备
>集线器
不用电缆而使用双绞线。每个站需要用两对双绞线，分别用于发送和接收
使用电子器件模拟实际电缆线的工作，整个系统像传统以太网一样工作
个工作日站使用的协议仍然是CSMA/CD协议，共享逻辑上总线
集线器像一个多接口的转发器，工作在**物理层**


*同轴电缆&&双绞线&&光纤*
>1.同轴电缆较便宜，铺设较方便。但传输距离近，高频传输信号衰减较大。
仅适用于短距离的传输，200m
2.双绞线：价格便宜，接入方便，抗干扰性好，距离较同轴电缆远很多，最大2400m
但是抗老化能力弱，一次只能传输一路图像。
3.光纤传输的信号损耗小，噪声与失真小，传输质量高，适合远距离传送。但是铺设困难，对于短距离，小规模的监控系统。
*价格高、难架设、难维修*

10BASE-T双绞线以太网的出现，是局域网发展史上一个非常重要的里程碑，它为以太网在局域网中的统治地位奠定了牢靠的基础。

#### MAC层的硬件地址
局域网中，硬件地址又称为物理地址，或MAC地址。
此处的地址严格来讲是每一个站的**名字**或**标识符**
这个名字48位

* 48位MAC地址
IEEE的注册管理机构RA负责向厂家分配地址字段的前三个字节（即高位24位）
地址字段的后三个字节（低位24位）由厂家
自行指派，称为**扩展标识符*，必须保证生产出的适配器没有重复地址。
MAC地址实际上就是适配器地址或适配器标识符EUI-48

适配器每从网络上收到一个MAC帧就首先用硬件检查MAC帧里的MAC地址
>1.如果发往本站的帧则收下，进行其他处理
2.否则丢弃

发往本站的帧包括以下三种
>1.单播帧（一对一）
2.广播帧（一对全体）
3.多播帧（一对多）

MAC帧的格式
>1.DIX Ethernet V2标准（常用）
2.IEEE的802.3标准

* 以太网的V2格式
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/8.jpg)
>1.类型：用来标志上一层使用的是什么协议，以便将受到的MAC帧的数据上交给上一层的这个协议
2.数据：IP数据报，最短为
64字节-6-6-4-2=46字节
范围：46~1500字节
不足46字节，应增加填充字段
3.FCS：检错
4.实际情况要在首部加入8字节：实现**比特同步**。前七字节是**同步码**，最后一个字节是**帧开始定界符**

有效的MAC帧的特点：
>1.帧的长度是整数字节
2.FCS无出错
3.数据字段长度在46~1500
4.有效MAC帧长度在64~1518

若检查到无效MAC帧，直接丢弃，以太网不负责重传

局域网的技术特点：
三个技术要素
>1.网络拓扑结构
2.传输介质
3.介质访问控制方法

* 拓扑结构：
>一个网络的通信链路和节点的几何排列或物理布局图形

*展现结点的相对位置信息及连接方式，不展现其大小*

基本拓扑结构：
>1.总线型
2.星型
3.环型

其中树型是星型的扩展，混合型是三种的结合

* 传输介质
>1.有线：双绞线、同轴电缆和光纤
2.无线：微波、红外线、激光、无线电等

*网线材质：双绞线或同轴电缆，同轴电缆已经逐渐被淘汰*

* 介质访问控制方法
局域网的信道属于广播信道，共享总线，多个节点争用信道。
这种访问称为：多路访问技术。
局域网的介质控制方式：
>1.受控方式
2.随机方式

环形拓扑结构：
>使用一个连续的环将每台计算机设备连接在一起
在粗同轴电缆总线结构的基础上，去掉线缆两端的终结器后，将线缆两头连接起来而形成的一个封闭的环

特点：
>1.闭合
2.沿一个方向传输
3.多个节点共享一个环通路
4.实际应用，一般为双环，主环和备环

优点：
>1.控制简单
2.重负载下信道利用率高
3.通信电缆短
4.不存在数据冲突

缺点：
>1.节点过多是，响应时间延长
2.封闭回路不便于扩充
3.维护困难
4.点故障会引起全网故障，且故障检测难
5.信道利用率低

*为什么说重负载下信道利用率高，而缺点中说信道利用率低？*
*环形拓扑采用**令牌传输**的方式，可以类比于丢手绢，10人传递一个手绢，则在某一时间，总会有9个人空闲，这是负载轻的情况。10传递10个手绢，则10个人均不空闲，高效工作。*

*也可以理解为**环形流水线***
流水线同样要处理连续的大量数据才能发挥其效力


* 扩展以太网
三张方式：
>1.在物理层扩展
2.在数据链路层扩展
3.虚拟局域网

物理层扩展
>1.使用光纤扩展（传输距离长）
**主机**通过光纤和几公里意外的**集线器**相连接
中间在两端要使用一对**光纤调制解调器**。

调制解调器的作用：
>分为**调制器**和**解调器**
调制器：将**数字信号**（计算机语言）翻译为**模拟信号**（普通电话线语言）
解调器：将**模拟信号**翻译为**数字信号**

故光纤扩展的流程：
>计算机发出数字信号，经过调制解调器，翻译为模拟信号，通过光纤传输，另一端的调制解调器接收模拟信号，翻译为数字信号，传输给接收方计算机。

2.使用集线器扩展
>用主干集线器去连接其他集线器
可以连接成更大的，多级的星型结构的以太网

例子：
>一个学院通过主干集线器，将三个系的以太网连接起来（三个独立的碰撞域）

![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/9.JPG)

优点：
>1.使得不同碰撞域的以太网能够**跨碰撞域通信**
2.扩大了以太网覆盖的地理范围

缺点：
>1.吞吐率未提高
2.不同碰撞域要使用相同的数据率，才能使用集线器互连

*怎么理解吞吐量未提高？*
*吞吐量：单位时间内通过某个网络（或信道、接口）的数据量*
*若软工、计科、信计不可以相互通信，通过集线器实现了通信，此时我能通信的人变多了，但是我和同学的通信速度并没有得到改善*

*复习集线器*
*存在于**物理层**，只负责转发比特，对信号整形放大，以扩大传输距离，不进行碰撞检测等等，广播发送，无学习能力*
*一定程度上类似于校园的大喇叭广播*

*如何理解集线器下的不同碰撞域数据率要相同？*
to be continue...

3.通过数据链路扩展以太网
（常用）
>通过网桥（交换式集线器、第二层交换机）：工作在数据链路层
有目的的转发：根据**MAC帧**的目的地址对收到的帧进行**转发**和**过滤**
网桥收到一个帧，先检查其目的MAC地址，然后确定转发到哪个接口，或者丢弃

*不在盲目转发，效率大大提高*

*如何理解设备*
*首先确定在哪层工作，由此来决定其工作范围，如在物理层工作的设备无法进行碰撞处理，只进行转发。工作在链路层的设备可能就要进行错误分析。*

以太网交换机：
>多接口的网桥

通常由十几个或更多的接口

每个接口都直接与一个**单台主机**或另一个**以太网交换机**相连，**全双工通信**
具有并行性：
>能同时连接多对接口，使多对主机同时通信
相互通信的主机都是**独占传输媒体**，**无碰撞**地传输数据

特点：
>1.接口设有存储器，能在输出端口繁忙时，把到来的帧进行**缓存**
2.即插即用，其内部的**帧交换表**（地址表）是**自学习算法**逐渐建立起来的
3.使用**专用的交换结构芯片**，使用**硬件转发**，转发速率比使用**软件转发的网桥**快很多

优点：（与共享式主线的比较）
>1.用户独享带宽，增加了总容量，扩大了N倍（其中N为用户数，更准确的说是交换机接口数）
2.从共享主线转到交换式以太网，所有接入设备的软件、硬件、适配器等都不需要做任何改动
3.提供多种速率的接口，方便不同用户

*如何理解这种差异*
*以通知取快递为例，若所有人共用一根电话线，500个快递，800个用户，快递员分发快递A，800个用户都要接电话，来判断是否是自己的快递，是则进行下一步操作；不是，则忽略这个消息。每个人要接500次电话，这是共享式主线。之后为改善情况，每个人使用不同的电话线，快递员可以通过电话（MAC地址）打给特定的人，每人只用接收处理自己的快递信息，这是以太网交换机*

以太网交换机的交换方式：
>1.存储转发：
先缓存，进行处理后，再转发
耗时
2.直通方式：
接收后立即按照目的MAC地址进行，转发
提高了帧的转发速度，但是因为未检查差错，可能会转发出无效帧

当对帧需要进行进一步处理（如线路速率匹配、协议转换、差错检测），再转发，则需要经过
>基于软件的存储转发

自学习算法
举例说明：
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/10.JPG)
初始交换表示空的
A想向B发送消息，将A和其接口写入交换表
，查询是否有MAC地址为B，无，则进行广播这个帧，B、C、D均接收信息，C、D因为目的地址不吻合，将此帧丢弃。发送完毕。
此时表中多了（A，1）
当C向A发送消息，先检查交换表，查到A的接口为1，即向1发送帧。
经过一段时后，交换表会趋于完善

为什么要设置有效时间？
>可能有时接口要更换主机，或者主机要更换接口，这个时候就要更改交换表中的项目。
这样过期项目会自动被删除。

存在的问题：
可能会产生无限制兜圈的环路
###没网，后续补充
to be continue...

改进：
>使用生成树协议
使得一台主机到其他所有主机的路径都是**无环路的树状结构**
不改变网络的**实际拓扑**，但在**逻辑上**要切断某些链路

**结合离散数学图与树的转换？*

* 从总线以太网到星型以太网
原因：
>共享以太网采用CSMA/CD协议，网络性能不足

故产生了交换式局域网
*即之前所讲到的使用**以太网交换机**的局域网*
*性质也和之前一样*
>由半双工转为全双工，故不产生碰撞
仍采用以太网的帧结构
转发器向所有端口广播，而交换机只根据MAC地址发送到适当的端口，即取快递的例子

![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/11.JPG)
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/12.JPG)

* 虚拟局域网VLAN
仅仅是局域网提供给用户的一种服务，**并非新型局域网**。
利用交换机可以很方便地实现虚拟局域网
由一些局域网网段构成的**与物理位置无关**的逻辑组

*为什么要应用虚拟局域网？*
继续以快递为例，若是一份重要的快递在海洋大学丢失，处理不当可能会造成危险，且假设快递一定还在海洋大学。这时，学校只需按下"广播"键，打通全校的电话来通知，可是因为广播未设置隔离，一旦按下，全世界都会接到电话。
这就形成了**“广播风暴”**，广播帧席卷整个交换式以太网，占用大量带宽，大大降低了整个以太网的性能

如果把**广播域**由“全球”改为“全校”，是不是问题就好多了？
由此便产生了虚拟局域网
>将具有某些共同需求的网段形成一个VLAN，每个VLAN有明确的标识符，用以指明这个帧由哪个VLAN的工作站发出。
同一个VLAN（工作组）中的成员可以改变其物理地址，而不必重新分配节点

性质：
>A、B、C属于VLAN1，D、E属于VLAN2

当A发送数据是，B、C可以接受到广播消息，D、E不会接收到广播消息
其中VLAN1，VLAN2称为子广播域

*即局部使用共享主线，整体使用交换式局域网？*
此处并不确定，局部发送消息一定是以广播的形式，to be continue
所谓共享主线和交换在此处仅是逻辑上的，并非物理连接

* 虚拟局域网使用的以太网帧格式
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/13.JPG)
和以太网的MAC帧格式进行比较
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/8.jpg)

不考虑以太网MAC帧用于比特同步的8字节，
虚拟局域网的以太网帧**多了4个字节**用于
>作为VLAN标识符
其中前两个字节的 标记类型（即标记格式）
后两个字节的 标记控制信息（即标记内容）

WLAN的划分：
基于交换机端口

WLAN的优点：
>1.灵活组织逻辑工作组，方便局域网管理
>2.限制了广播通信量，提高了局域网系统性能
3.可以通过制定交换机转发规则，提高局域网系统的安全性

*各种设备的汇总比较
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/14.JPG)
*其中中继器即为转发器，集线器是为星型结构的转发器；交换机是多接口的网桥*

* 高速以太网
>速率超过**100Mb/s**的以太网

*遵循**CSMA/CD协议**的**必不是** **全双工***


### 网络层详解
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/15.JPG)

网络层：
>通信子网的最高层，对上层屏蔽子网通信细节（子网类型、拓扑结构、子网数目等）

在计算机系统中，谁来负责可靠交付？
>1.网络（面向连接）
2.端系统（无连接）

电信网的成功经验
>面向连接

两台主机之间的网络层建立**虚电路**进行传输
仅是**逻辑连接**，与电话交换的电话通信只是类似，并不完全一样

* 因特网的设计思路
>1.向上提供**无连接、尽最大努力**的数据报服务
2.发送分组时**不事先建立连接**，前后分组**独立发送，不编号**
3.不提供服务质量的承诺，可能出错或超时

* 网络协议IP
配套使用的三个协议：
>1.地址解析协议ARP
>2.网际控制报文协议ICMP
>3.网际管理协议IGMP

![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/16.JPG)

设备：
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/18.JPG)

互联网是指用**路由器**互连的网络
转发器和网桥仅是将网络扩大，并非**网络互连**
网络层使用的路由器因历史原因被称作**网关**（并非真实网关）

* 虚拟互连网络
逻辑互连网络
*将物理网络的易构性透明化*
我们利用IP协议时，不同架构的网络对我们来说是统一的
使用IP协议的虚拟互联网络简称为IP网

* IP地址
>给每个连接在因特网上的主机（路由器）分配的在全世界范围内**唯一的32位标识符**

由因特网名字与号码指派公司ICANN进行分配

* IP地址的编码方式
>1.分类的IP地址
2.子网的划分
3.构成超网

分类的IP地址：
>网络号+主机号（路由器） 共32位

C类网络号三个字节，主机号一个字节

*故可用的网络号越多，可用的主机号越少*
*参考分页式存储的页号和页长的关系*

点分十进制法
IP地址一般每8位转换为10进制，并加点隔开，提高可读性 （2<sup>7</sup>=128）
>192.168.136.2

特殊地址：
注意0、1、127即可
*一般规律，全1为老大，全0为初始，127回送，只能发送给自己*
>即若网络号全为0，只能在本网内发送；
主机号全为0，即本网地址；
32位全为0，全网地址；
主机号全为1，可以向本网内发送广播；
32位全为1，可以向全网发送广播；
127 localhost不被其他主机或路由器接收

网络号+主机号的方式被称为**分等级的地址结构**
优点：
>1.IP管理机构仅分配网络号
2.路由器仅根据目的主机所连接的网络号来转发分组，减少路由表里的项目数

*即上海派件员只将快递分发到海洋大学，再由海洋大学进行处理，而不用考虑具体派件给谁*

IP地址实质：
>一个主机（路由器）+一个链路的接口

当一个主机同时接入两个网络，主机必须具有两个相应的IP地址，这种主机被称为**多归属主机**

路由器至少有两个不同的IP地址
这样才能把IP数据报由一个网络转发到另一个网络

同一个局域网内的IP地址的网络号一致
**C类IP看前三个字节**
即192.168.137.5中的192.168.137

路由器的有几个接口就有几个不同网络号的IP地址

*网桥、Ethernet交换机、集线器Hub是否需要分配IP地址？*
这些设备只是扩充网络，并非用于网络互连，不需要分配IP地址。
甚至在IP协议中，其处在虚拟局域网中，是透明的。

网路层及以上使用**IP地址**
网络层及以下使用**硬件地址**

IP数据报的首部仅记录**源地址**和**目的地址**，并不记录其中转发路由器的地址
路由器根据IP地址的**网络号**进行路由选择

* 地址解析协议ARP
无论选择何种协议，最终还是通过硬件地址传输

>ARP提供IP地址与硬件地址的转换

每一个主机设有一个ARP告诉缓存，存有所在局域网IP地址到硬件地址的映射表

主机A向主机B发送IP数据报流程：
>主机A在ARP查找是否有主机B的IP，若有，查出其对应的硬件地址，写入MAC帧，通过局域网传输到此硬件地址

*ARP高速缓存的工作方式类似于**以太网交换机的自学习***
主机A向主机B发送数据报
>发送请求时，将自身的IP地址和硬件地址的映射写入ARP缓存，进行广播，主机B收到请求，同时将主机A的映射写入ARP高速缓存，以后B向A发送数据报就更方便。

*举个例子，班级同学通信，同学lzy想向同学翠花表白，但是并没有翠花的手机号，就在班级中大喊：“我是lzy，我是手机号是16621360553，翠花，俺中意你”。此时翠花接收消息，并在通讯录上记下[lzy，16621360553]。*
*这样，之后翠花要是想对lzy同学说话，就不用让所有人都听到了，直接拨打其手机号即可。*

若是所要通信的主机不在同一个局域网内怎么办？
>通过ARP找到一个位于本局域网的路由器的硬件地址，让他转发给相应的网络，剩下的交给下一个网络处理

为什么不直接通过硬件地址通信？
IP地址将“取名规范化”，通信变得简单，硬件地址的格式不同，想要通信要进行非常犊砸的硬件地址转换，这几乎不可能。

*假设A会说中文，B会说英文，C会说法语，D会说日语*
提供两种方案
1.直接对话，若是想互相交流，A就要能听得懂其他三种语言，并且能翻译成中文。
若是总共有3000种语言，A就要学会将2999种语言翻译为中文。**这种即为直接物理地址通信**
2.第二种都学会英语，A和其他人交流，仅需要说英语一种语言即可，即使有3000语言，也仅需会中文和英文就可以了。**这种为使用同一的IP地址。**
*不同网络之间使用公共层也是这个意思*


地址解析ARP：IP地址到物理地址
反向地址解析RARP：物理地址到IP地址

* IP数据报的格式
![img](https://github.com/WhiteBlacken/MypostImage/raw/master/ComputerNetWork/19.JPG)
由**首部**+**数据**两部分组成
首部前20字节为固定长度，固定长度后面是可选字段
>版本：IP协议的版本，一般IPv4
首部长度：占四位，最高可表示15个单位，一个单位为4字节，即首部长度最多**60字节**
总长度：首部+数据长度之和，占16位，最大长度为65535字节
标识：计数器，产生数据包的标识
标志：只有其中的两位有意义，MF=1，表示后面还有分片；MF=0，表示是最后一个分片
DF=0，允许分片
片偏移：较长的分组在分片后，某片在原分组的相对位置，以8个字节为偏移单位
生存时间：TTL,数据报可通过的最大路由数
协议：指出携带的数据使用何种协议，以便目的主机的IP层将数据上交给哪个进程
首部检验和：只检验数据报告的首部，不检验数据部分。仅采用简单计算方法，不采用CRC
选项字段：1~40字节，用来增加功能，但是增加了路由器处理数据的开销。很少被用到

* IP层转发分组
路由表
按照主机所在的网络地址来制作路由表

目的主机所在网络 | 下一跳地址
---- | ----
20.0.0.0  | 直接交付，接口0
30.0.0.0    | 直接交付，接口1
10.0.0.0 | 20.0.0.7
40.0.0.0 | 30.0.0.1

默认路由（静态路由）
>一个网络只有很少的对外连接时使用。
路由表中若无匹配的目的地址，则转去静态路由。

*相当于else*

如何确定下一跳路由器的IP地址？
>1.IP数据报的首部并没有可以指明下一跳路由器IP地址的字节。
路由器收到待转发的数据报，将下一跳的IP地址送交下层网络接口软件。
网络接口软件使用ARP将IP地址转换为硬件地址，存入MAC帧的首部，根据硬件地址找到下一跳的路由器。

分组转发：
*树状分支算法*
*提取目的主机IP地址D中的目的网络地址N。若此路由器直接与网络N相连，直接传输给D；若不相连，寻找有目的地址为D的特定主机路由，传给路由表对应的下一跳；若没有，寻找到达网络N的路由，若有，传给路由表指定的下一跳；若没有，传送给默认路由；若无默认路由，则报告转发分组出错。

* 划分子网
两级地址到三级地址
两级地址：
>网络号+主机号

三级地址：
>网络号+子网号+主机号

子网号是从主机号中借用的
这是单位内部的事情，对外仍是网络号展现的网络

为什么使用三级地址？
>1.二级地址的空间利用率低
2.每一个物理网络对应一个网络号，使得路由表过大而性能受损
3.两级IP不够灵活

如何理解？
*以学号举例*
*假设海洋大学17级共有10000名学生，给他们编写学号，现在需要找到海洋大学的软件工程专业的lzy*
*第一种，编码为1~10000。那么遍历学号及其对应的姓名，平均访问大约在5000次*
*第二种，先划分出专业号。假设100个专业，一个专业100人。先遍历专业，找到软件工程，平均50次。再遍历专业内人员，找到lzy，平均50次。平均访问在50次*
第二种即为划分子网的方式，路由表中只需要放置“专业号”和“专业”，相比之前的10000项，只保留了10项，路由器的负担大大减少。

如何判断是否进行了子网划分？
>从IP数据报的首部无法判断源主机或目的主机是否进行了子网划分
使用**子网掩码**可以找出IP地址中的子网部分

如何确定子网掩码？
>网络所有为填1，主机号所有位填0

相关计算：
>子网掩码和地址逻辑与得到网络号
子网掩码取反后和地址逻辑与得到主机号

举例：
假设一个B级IP地址为
>145.13.3.10

子网掩码为
>255.255.255.0

问：是否进行了子网划分？

B级IP地址的网络号占两个字节。

用**子网掩码**和**IP地址**按位与，得到网络号：
>145.13.3.0

此时网络号占了3个字节，并非B级网络默认的两个字节，因为主机号的一个字节被“借”来做了子网号，故进行了子网划分。

实际上，B级IP地址默认的子网掩码为
>255.255.0.0

与题中的子网掩码
>255.255.255.0

比较可得，进行了子网划分

*子网掩码和IP地址共同决定了路由器的查询路径*
1.故路由器交换路由信息时，同时要给出子网掩码。
2.路由表的每一个项目，除了给出网络地址，同时要给出子网掩码

进行了子网划分，IP地址的分组转发首先要重新确定网络号。
每一步之前需要先用**IP地址**和**子网掩码**按位与确定网络号，其他不变

* 无分类编址CIDR
二级IP
>网络前缀+主机号

不过此处的网络前缀是可以任意长短的
IP地址后加上一个/，斜线后加上网络前缀所占的位数

网络前缀都相同的连续IP地址组成**CIDR地址块**
即一个CIDR地址块可以表示很多地址，使得路由器里一个项目可以表示很多传统地址，这种聚合被称为**路由聚合**，又称**构成超网**

虽然不使用子网，但仍使用**掩码**
即将网络前缀全部置1

举例说明，现在有一个IP地址：
>128.14.30.0/20

前20位为网络前缀
>1000 0000 0000 1110 0010 | 0000 0000 0000

竖线前为网络前缀，竖线后为主机号
则地址块的最小地址：竖线后全置0
>128.14.32.0

地址块的最大地址：竖线后全置1
>128.14.47.255

CIDR的其他记法：
>10.0.0.0/10

可以记为
10/10

* 构成超网
>前缀不超过23位的CIDR地址块包含了多个C类地址
这些C类地址合起来就构成了超网
CIDR的地址数一定是**2的整数次幂**

* CIDR地址划分
to be continue

* 最长前缀匹配（最长匹配，最佳匹配）
>当路由表中的每个项目由“网络前缀”和“下一跳地址”组成时，查找路由器可能找到不止一个结果

选择
>最长网络前缀

因为网络前缀越长，需要“遍历”的地址块越少

* 网络控制报文协议ICMP
>允许主机或路由器报告差错，提供异常情况的报告
不是高层协议，是IP层协议
可以封装到IP数据报中，作为IP数据发送出去

* 因特网路由选择协议
不存在绝对的最佳路由算法
>1.静态路由选择策略：非自适应路由选择
开销小，简单，不能及时适应网络状态的变化
人工建立
2.动态路由选择策略：自适应路由选择，能够较好的适应网络状态的变化
但实现复杂，开销大
系统自动更新
不同的网络要使用不同的动态路由选择协议

静态路由糖厂被使用在叶节点，单向
故需要在两个网络之间的**边缘路由器**双方互指

* 分层次的路由选择协议
即内部处理对外透明

* 两大路由选择协议
>1.内部网关协议IGP
2.外部网关协议EGP

*海洋大学内部的通信使用内部网关协议，海洋大学与其他学校的通信使用外部网关协议

内部网关协议
RIP：
>基于距离
>每一个路由器要维护自己到其他每一个母的网络的距离

到直接网络的距离为1，每经过一个路由器，距离+1
RIP认为，“距离”越短，路由越好

三个要点：
>1.仅和相邻路由器交换信息
2.交换的是路由表
3.按固定间隔交换

算法过程：
收到相邻路由器C的RIP报文
>1.把下一跳地址改为C，且“距离”加1
2.若目的网络不在路由表，加入该项
下一跳为C，将距离替换
若收到项目的距离小于路由表的距离，则更新

若3分钟没收到相邻路由器更新路由表，则该相邻路由器出现故障，将距离置为16

优点：简单、开销小

缺点：
>1.网络故障时，要经过很长时间才能传送到所有路由器
2.最大使用距离15，限制了网络的规模
3.路由表随着网络规模的增加，开销增加


OSPF协议：
*参考离散数学“最短路径优先”*
to be continue

洪泛法和虚拟局域网思想一致
我太累了，顶不住了

OSPF直接使用IP数据报传送，且数据报很短
适用于互联网那个规模很大的情况
且响应网络变化快，小于100ms

* 外部网关协议BGP
不同自治系统之间的连接只需满足“可达”，“不兜圈子"即可
每个自治系统要选择**边界路由器**，作为发言人
BGP发言人也不一定非要是边界路由器
